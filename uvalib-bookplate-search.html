<link rel="import" href="../uvalib-theme/uvalib-ui-element.html">
<link rel="import" href="../uvalib-theme/uvalib-theme.html">
<link rel="import" href="../uvalib-theme/uvalib-page-style.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-card/paper-card.html">
<link rel="import" href="../uvalib-search-box/uvalib-simple-search-box.html">
<link rel="import" href="../uva-models/uva-library.html">
<link rel="import" href="../iron-location/iron-location.html">
<link rel="import" href="../iron-location/iron-query-params.html">

<dom-module id="uvalib-bookplate-search">
  <template>
    <custom-style>
      <style include="uvalib-theme iron-flex uvalib-page-style"></style>
    </custom-style>

    <uva-library path="bookplates" last-response="{{bookplates}}"></uva-library>
    <iron-location query="{{_qs}}"></iron-location>
    <iron-query-params params-string="{{_qs}}" params-object="{{params}}"></iron-query-params>

    <div class="upper">
      <p>
        Your search term "[[params.q]]" returned the following results:
      </p>
      <div class="results">
        <template is="dom-repeat" items="[[_searchBookplates(params.q,bookplates)]]">
          <paper-card image="[[item.bookplateImage.url]]" alt="[[item.bookplateImage.alt]]">
            <div class="card-content">
              <h3>[[item.title]]</h3>
            </div>
            <div class="card-actions">
              <a href="[[_mkBookplateURL(item.fundID)]]" tabindex="-1"><paper-button>View More</paper-button></a>
            </div>
          </paper-card>
        </template>
      </div>
    </div>

    <div class="lower">
      <h2>Search E-bookplates funds again</h2>
      <div class="layout horizontal">
        <uvalib-simple-search-box on-submit="_pullQuery" value="{{query}}"></uvalib-simple-search-box>
        <div>
          <a tabindex="-1" href="/bookplates"><paper-button>View All Funds</paper-button></a>
        </div>
      </div>
    </div>

  </template>

  <script>
    /**
     * `uvalib-bookplate-search`
     *
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class UvalibBookplateSearch extends UvalibUiElement {
      static get is() { return 'uvalib-bookplate-search'; }
      static get properties() {
        return Object.assign(super.properties,{
          params: {
            type:Object,
            observer: '_updatequery'
          },
          query: {
            type: String
          }
        });
      }
      //Concat the this elements template with the parents
      static get template() {
        var parentTemplate = UvalibUiElement.template.cloneNode(true);
        var childTemplate = Polymer.DomModule.import('uvalib-bookplate-search', 'template');
        parentTemplate.content.insertBefore(childTemplate.content,null);
        return parentTemplate;
      }
      _updatequery(){
        this.query = this.params.q;
      }
      _pullQuery(e){
        this.set('params.q', e.currentTarget.value);
      }
      _searchBookplates(query){
        if (this.bookplates)
            // Todo: filter by query
            return this.bookplates;
      }
      _mkBookplateURL(fundID){
        return "/bookplates/"+fundID;
      }
    }

    window.customElements.define(UvalibBookplateSearch.is, UvalibBookplateSearch);
  </script>
</dom-module>
